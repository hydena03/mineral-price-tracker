<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>광물 가격 트래커</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .graph-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .graph-title {
            font-size: 1.2em;
            color: #444;
            margin-bottom: 10px;
        }
        .graph-image {
            width: 100%;
            max-width: 100%;
            height: auto;
            border-radius: 4px;
        }
        .timestamp {
            color: #666;
            font-size: 0.9em;
            margin-top: 10px;
        }
        .no-graphs {
            text-align: center;
            padding: 40px;
            color: #666;
        }
    </style>
</head>
<body>
    <h1>광물 가격 트래커</h1>
    <div id="graphs">
        <div class="no-graphs">
            <h2>그래프를 생성하려면:</h2>
            <p>1. Python 스크립트를 실행하세요</p>
            <p>2. 메뉴에서 "1. 새로운 그래프 생성" 선택</p>
            <p>3. 원하는 기간 선택 (1주일, 1개월, 1년, 5년)</p>
            <p>4. 생성된 그래프가 여기에 자동으로 표시됩니다</p>
        </div>
    </div>

    <script type="module">
        // Firebase 초기화
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getStorage, ref, listAll, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDZZxO6AhpZkfSKOyPmQ9kDzNFEDyQV0Yk",
            authDomain: "mineralpricetracking.firebaseapp.com",
            projectId: "mineralpricetracking",
            storageBucket: "mineralpricetracking.appspot.com",
            messagingSenderId: "1098332029995",
            appId: "1:1098332029995:web:c7a7d9f2dd9d8f7f9d3d3c"
        };

        // Firebase 초기화
        const app = initializeApp(firebaseConfig);
        const storage = getStorage(app);

        // Storage에서 이미지 가져오기
        async function loadImages() {
            const graphsDiv = document.getElementById('graphs');
            graphsDiv.innerHTML = ''; // 기존 내용 삭제

            try {
                const listRef = ref(storage, 'mineral_prices');
                const res = await listAll(listRef);
                
                // 최신 파일부터 보여주기 위해 역순 정렬
                const items = res.items.sort((a, b) => b.name.localeCompare(a.name));
                
                if (items.length === 0) {
                    graphsDiv.innerHTML = `
                        <div class="no-graphs">
                            <h2>그래프를 생성하려면:</h2>
                            <p>1. Python 스크립트를 실행하세요</p>
                            <p>2. 메뉴에서 "1. 새로운 그래프 생성" 선택</p>
                            <p>3. 원하는 기간 선택 (1주일, 1개월, 1년, 5년)</p>
                            <p>4. 생성된 그래프가 여기에 자동으로 표시됩니다</p>
                        </div>
                    `;
                    return;
                }
                
                for (const itemRef of items) {
                    const url = await getDownloadURL(itemRef);
                    const filename = itemRef.name;
                    const period = filename.split('_')[0];
                    const timestamp = filename.split('_')[1].replace('.png', '');
                    
                    const container = document.createElement('div');
                    container.className = 'graph-container';
                    container.innerHTML = `
                        <div class="graph-title">광물 가격 변화 (${period})</div>
                        <img class="graph-image" src="${url}" alt="광물 가격 그래프">
                        <div class="timestamp">업데이트: ${formatTimestamp(timestamp)}</div>
                    `;
                    graphsDiv.appendChild(container);
                }
            } catch (error) {
                console.error('Error loading images:', error);
                graphsDiv.innerHTML = '<div class="no-graphs">그래프를 불러오는 중 오류가 발생했습니다.</div>';
            }
        }

        function formatTimestamp(timestamp) {
            const year = timestamp.substring(0, 4);
            const month = timestamp.substring(4, 6);
            const day = timestamp.substring(6, 8);
            const hour = timestamp.substring(8, 10);
            const minute = timestamp.substring(10, 12);
            return `${year}-${month}-${day} ${hour}:${minute}`;
        }

        // 페이지 로드 시 이미지 로드
        loadImages();
    </script>
</body>
</html> 